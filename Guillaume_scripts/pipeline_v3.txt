
#build metabam files for each experiment
bsub -o THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002670_H3K4me1.out -e THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002670_H3K4me1.err -J buildmetabamfile_EGAD00001002670_me1 -q normal -M 64000000 "python3.5 build_metabamfile_v3.py /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002670/H3K4me1 THREE_CELL_TYPES/METABAM/EGAD00001002670_H3K4me1_50samples.metafile.bam"
bsub -o THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002672_H3K4me1.out -e THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002672_H3K4me1.err -J buildmetabamfile_EGAD00001002672_me1 -q normal -M 64000000 "python3.5 build_metabamfile_v3.py /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002672/H3K4me1 THREE_CELL_TYPES/METABAM/EGAD00001002672_H3K4me1_50samples.metafile.bam"
bsub -o THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002673_H3K4me1.out -e THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002673_H3K4me1.err -J buildmetabamfile_EGAD00001002673_me1 -q normal -M 64000000 "python3.5 build_metabamfile_v3.py /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002673/H3K4me1 THREE_CELL_TYPES/METABAM/EGAD00001002673_H3K4me1_50samples.metafile.bam"
bsub -o THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002670_H3K27ac.out -e THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002670_H3K27ac.err -J buildmetabamfile_EGAD00001002670_27ac -q normal -M 64000000 "python3.5 build_metabamfile_v3.py /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002670/H3K27ac THREE_CELL_TYPES/METABAM/EGAD00001002670_H3K27ac_50samples.metafile.bam"
bsub -o THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002672_H3K27ac.out -e THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002672_H3K27ac.err -J buildmetabamfile_EGAD00001002672_27ac -q normal -M 64000000 "python3.5 build_metabamfile_v3.py /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002672/H3K27ac THREE_CELL_TYPES/METABAM/EGAD00001002672_H3K27ac_50samples.metafile.bam"
bsub -o THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002673_H3K27ac.out -e THREE_CELL_TYPES/METABAM/buildmetabamfile_EGAD00001002673_H3K27ac.err -J buildmetabamfile_EGAD00001002673_27ac -q normal -M 64000000 "python3.5 build_metabamfile_v3.py /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002673/H3K27ac THREE_CELL_TYPES/METABAM/EGAD00001002673_H3K27ac_50samples.metafile.bam"

#merge metabam files
samtools merge H3K4me1.metafile.bam EGAD0000100267?_H3K4me1_50samples.metafile.bam
samtools merge H3K27ac.metafile.unsorted.bam EGAD0000100267?_H3K27ac_50samples.metafile.bam
samtools sort -T H3K27actmpunsorted -o H3K27ac.metafile.bam H3K27ac.metafile.unsorted.bam

#run homer on metabam files
python3 run_homer_metabam.py THREE_CELL_TYPES/METABAM/H3K4me1.metafile.bam THREE_CELL_TYPES/HOMER_files/H3K4me1
python3 run_homer_metabam.py THREE_CELL_TYPES/METABAM/H3K27ac.metafile.bam THREE_CELL_TYPES/HOMER_files/H3K27ac

#run homer to quantify all samples
python3 run_homer_quantif.py THREE_CELL_TYPES/METABAM/H3K27ac.metafile.bam /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002670/H3K27ac/ THREE_CELL_TYPES/HOMER_files/H3K27ac THREE_CELL_TYPES/samples_to_exclude.txt
python3 run_homer_quantif.py THREE_CELL_TYPES/METABAM/H3K4me1.metafile.bam /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002670/H3K4me1/ THREE_CELL_TYPES/HOMER_files/H3K4me1/ THREE_CELL_TYPES/samples_to_exclude.txt 
python3 run_homer_quantif.py THREE_CELL_TYPES/METABAM/H3K4me1.metafile.bam /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002672/H3K4me1/ THREE_CELL_TYPES/HOMER_files/H3K4me1/ THREE_CELL_TYPES/samples_to_exclude.txt
python3 run_homer_quantif.py THREE_CELL_TYPES/METABAM/H3K4me1.metafile.bam /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002673/H3K4me1/ THREE_CELL_TYPES/HOMER_files/H3K4me1/ THREE_CELL_TYPES/samples_to_exclude.txt
python3 run_homer_quantif.py THREE_CELL_TYPES/METABAM/H3K27ac.metafile.bam /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002672/H3K27ac/ THREE_CELL_TYPES/HOMER_files/H3K27ac THREE_CELL_TYPES/samples_to_exclude.txt
python3 run_homer_quantif.py THREE_CELL_TYPES/METABAM/H3K27ac.metafile.bam /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002673/H3K27ac/ THREE_CELL_TYPES/HOMER_files/H3K27ac THREE_CELL_TYPES/samples_to_exclude.txt

#parse homer tables
python3.5 parse_homer_table.py THREE_CELL_TYPES/HOMER_files/H3K27ac/EGAD00001002670_H3K27ac.quantif.txt H3K27ac_
python3.5 parse_homer_table.py THREE_CELL_TYPES/HOMER_files/H3K27ac/EGAD00001002672_H3K27ac.quantif.txt H3K27ac_
python3.5 parse_homer_table.py THREE_CELL_TYPES/HOMER_files/H3K27ac/EGAD00001002673_H3K27ac.quantif.txt H3K27ac_
python3.5 parse_homer_table.py THREE_CELL_TYPES/HOMER_files/H3K4me1/EGAD00001002670_H3K4me1.quantif.txt H3K4me1_
python3.5 parse_homer_table.py THREE_CELL_TYPES/HOMER_files/H3K4me1/EGAD00001002672_H3K4me1.quantif.txt H3K4me1_
python3.5 parse_homer_table.py THREE_CELL_TYPES/HOMER_files/H3K4me1/EGAD00001002673_H3K4me1.quantif.txt H3K4me1_


#run qtltools
python3.5 bin/run_cis_eqtl_v3.0.py THREE_CELL_TYPES/HOMER_files/H3K27ac/EGAD00001002673_H3K27ac.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002673_H3K27ac_v3.0 THREE_CELL_TYPES/HOMER_files/H3K27ac/phenotypes_to_exclude.txt /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002673/METADATA/delimited_maps/Donor_id_Sex.map
python3.5 bin/run_cis_eqtl_v3.0.py THREE_CELL_TYPES/HOMER_files/H3K27ac/EGAD00001002672_H3K27ac.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002672_H3K27ac_v3.0 THREE_CELL_TYPES/HOMER_files/H3K27ac/phenotypes_to_exclude.txt /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002672/METADATA/delimited_maps/Donor_id_Sex.map
python3.5 bin/run_cis_eqtl_v3.0.py THREE_CELL_TYPES/HOMER_files/H3K27ac/EGAD00001002670_H3K27ac.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002670_H3K27ac_v3.0 THREE_CELL_TYPES/HOMER_files/H3K27ac/phenotypes_to_exclude.txt /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002670/METADATA/delimited_maps/Donor_id_Sex.map 
python3.5 bin/run_cis_eqtl_v3.0.py THREE_CELL_TYPES/HOMER_files/H3K4me1/EGAD00001002670_H3K4me1.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002670_H3K4me1_v3.0 THREE_CELL_TYPES/HOMER_files/H3K4me1/phenotypes_to_exclude.txt /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002670/METADATA/delimited_maps/Donor_id_Sex.map
python3.5 bin/run_cis_eqtl_v3.0.py THREE_CELL_TYPES/HOMER_files/H3K4me1/EGAD00001002672_H3K4me1.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002672_H3K4me1_v3.0 THREE_CELL_TYPES/HOMER_files/H3K4me1/phenotypes_to_exclude.txt /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002672/METADATA/delimited_maps/Donor_id_Sex.map
python3.5 bin/run_cis_eqtl_v3.0.py THREE_CELL_TYPES/HOMER_files/H3K4me1/EGAD00001002673_H3K4me1.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002673_H3K4me1_v3.0 THREE_CELL_TYPES/HOMER_files/H3K4me1/phenotypes_to_exclude.txt /data/unige/funpopgen/2backup/grey2/external_data/Blueprint_immune_cells/EGAD00001002673/METADATA/delimited_maps/Donor_id_Sex.map


#plot eqtl vs PC
Rscript plot_PC_vs_eQTL.R "THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002670_H3K27ac_v3.0/permutations_cov*.significant.txt" 12
Rscript plot_PC_vs_eQTL.R "THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002672_H3K27ac_v3.0/permutations_cov*.significant.txt" 12
Rscript plot_PC_vs_eQTL.R "THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002673_H3K27ac_v3.0/permutations_cov*.significant.txt" 12
Rscript plot_PC_vs_eQTL.R "THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002673_H3K4me1_v3.0/permutations_cov*.significant.txt" 12
Rscript plot_PC_vs_eQTL.R "THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002672_H3K4me1_v3.0/permutations_cov*.significant.txt" 12
Rscript plot_PC_vs_eQTL.R "THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002670_H3K4me1_v3.0/permutations_cov*.significant.txt" 12

#run clomics corr
python3.5 bin/run_clomics_corr_v3.0.py THREE_CELL_TYPES/HOMER_files/H3K4me1/EGAD00001002670_H3K4me1.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002670_H3K4me1_v3.0/covariates_10.txt THREE_CELL_TYPES/HOMER_files/H3K27ac/EGAD00001002670_H3K27ac.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002670_H3K27ac_v3.0/covariates_10.txt THREE_CELL_TYPES/CLOMICS/EGAD00001002670_CLOMICS_v3.0
python3.5 bin/run_clomics_corr_v3.0.py THREE_CELL_TYPES/HOMER_files/H3K4me1/EGAD00001002672_H3K4me1.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002672_H3K4me1_v3.0/covariates_10.txt THREE_CELL_TYPES/HOMER_files/H3K27ac/EGAD00001002672_H3K27ac.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002672_H3K27ac_v3.0/covariates_10.txt THREE_CELL_TYPES/CLOMICS/EGAD00001002672_CLOMICS_v3.0
python3.5 bin/run_clomics_corr_v3.0.py THREE_CELL_TYPES/HOMER_files/H3K4me1/EGAD00001002673_H3K4me1.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002673_H3K4me1_v3.0/covariates_10.txt THREE_CELL_TYPES/HOMER_files/H3K27ac/EGAD00001002673_H3K27ac.quantif.bed.gz THREE_CELL_TYPES/QTL_TOOLS/EGAD00001002673_H3K27ac_v3.0/covariates_10.txt THREE_CELL_TYPES/CLOMICS/EGAD00001002673_CLOMICS_v3.0



